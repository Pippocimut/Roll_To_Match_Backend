<!DOCTYPE html>
<html lang="en">

<%- include('../partials/head') %>
    </head>

    <%- include ('../partials/header') %>

    <body>
        <h1>Create Campaign</h1>
        <form id="create-campaign-form">
            <input type="text" name="title" placeholder="Title" class="border rounded p-2 mb-2">
            <input type="text" name="description" placeholder="Description" class="border rounded p-2 mb-2">
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Create</button>
        </form>
        <p id="error-message" class="text-red-500 mt-2 hidden"></p>

        <script>
            document.getElementById('create-campaign-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const data = {
                    title: formData.get('title'),
                    description: formData.get('description')
                };

                try {
                    const response = await fetch(`/api/v1/room/<%= roomId %>/campaign`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(errorText || 'Failed to create campaign');
                    }

                    const contentType = response.headers.get('content-type');
                    if (!contentType || !contentType.includes('application/json')) {
                        throw new Error('Server response was not JSON');
                    }

                    const responseData = await response.json();
                    window.location.href = `/campaign/${responseData.id}`;
                } catch (error) {
                    const errorMessage = document.getElementById('error-message');
                    errorMessage.textContent = error.message;
                    errorMessage.classList.remove('hidden');
                }
            });
        </script>

    </body>

    <footer>

    </footer>

</html>