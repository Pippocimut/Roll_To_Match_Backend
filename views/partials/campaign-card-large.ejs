<div id="campaign-card">
    <form action="/campaign/<%= campaign.id %>/candidate" method="post">
        <input type="hidden" name="campaignId" value="<%= campaign.id %>">
        <h2>
            <%= campaign.name %>
        </h2>
        <p>
            Description <%= campaign.description %>
        </p>
        <p>
            <% campaign.tags.forEach(tag=> { %>
                <%= tag %>
                    <% }) %>
        </p>
        <ul>
            <% campaign.playerQueue.forEach(player=> { %>
                <li>
                    <%= player.slug %>
                    <%= player.email %>
                    <%= player.id %>
                    <%= player.username %>
                    <%= JSON.stringify(player) %>
                    <% if(userId.toString()===player.id.toString()) { %>
                        <button id="remove-button">Remove</button>
                        <script>
                            document.addEventListener('DOMContentLoaded', () => {
                                const button = document.getElementById('remove-button')
                                button.addEventListener('click', async (e) => {
                                    e.preventDefault() // Impedisce l'invio del form
                                    e.stopPropagation() // Ferma la propagazione dell'evento

                                    try {
                                        const result = await fetch('/campaign/<%= campaign.id %>/player/<%= player.id %>', {
                                            method: 'DELETE',
                                            headers: {
                                                'Content-Type': 'application/json'
                                            }
                                        })

                                        if (result.ok) {
                                            // Opzionale: ricarica la pagina o aggiorna l'UI
                                            window.location.reload()
                                        } else {
                                            console.error('Errore nella rimozione:', await result.text())
                                        }
                                    } catch (error) {
                                        console.error('Errore nella richiesta:', error)
                                    }
                                })
                            })
                        </script>
                        <% } %>
                </li>
                <% }) %>
        </ul>
        <ul>
            <% campaign.activePlayers.forEach(player=> { %>
                <li>
                    <%= player.slug %>
                    <%= player.email %>
                    <%= player.id %>
                    <%= player.username %>
                    <button id="remove-button">Remove</button>
                    <script>
                        document.addEventListener('DOMContentLoaded', () => {
                            const button = document.getElementById('remove-button')
                            button.addEventListener('click', async (e) => {
                                e.preventDefault() // Impedisce l'invio del form
                                e.stopPropagation() // Ferma la propagazione dell'evento

                                try {
                                    const result = await fetch('/campaign/<%= campaign.id %>/player/<%= player.id %>', {
                                        method: 'DELETE',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        }
                                    })
                                } catch (error) {
                                    console.error('Errore nella richiesta:', error)
                                }
                            })
                        })
                    </script>
                </li>
                <% }) %>
        </ul>

        <input type="submit" value="Join Campaign">
    </form>
</div>